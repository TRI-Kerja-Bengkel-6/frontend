<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>Kerja Bengkel 6</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- Favicons -->
    <link href="assets/img/logo.png" rel="logo" />
    <link href="assets/img/logo.png" rel="apple-touch-icon" />

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet" />

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/aos/aos.css" rel="stylesheet" />
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
    <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet" />
    <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.0/css/bootstrap.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <!-- Template Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet" />
    
    <script>
      const formData = new FormData();
      const Email = sessionStorage.getItem("email");
      const Token = sessionStorage.getItem("token");
      console.log(Token);
      formData.append("email", Email);
      axios
        .post("http://api.kerbengenam.my.id/v1/getUserDomain?", formData, {
          headers: {
            "Content-Type": "multipart/form-data",
            "Authorization": `Bearer ${Token}`
          },
        })
        .then((response) => {
          console.log(response);
          var Domain = response.data.domain;
          console.log(Domain)
          $(document).ready(function() {
            var parent = $('#email');
            $("#email").text(`Hi, ${Email}`);
            for (let i = 0; i < Domain.length; i++) {
              fetch(`http://${Domain[i]}`, {mode: 'no-cors'})
              .then((response) => $("#table").prepend(`<tr><th scope="row${i}">${i}</th><td>${Domain[i]}</td><td>${response.status}</td><td><a class="btn btn-primary" href="http://${Domain[i]}" role="button">Redirect</a></td></tr>`))
            }
            $("#store").prepend(`<div class="btn-wrap">
                <button class="btn-buy buyNow">Order</button>
              </div>`)
          });
          console.log($('#email'))
        })
        .catch((error) => {
          console.error(error)
        });

      $(document).ready(function () {
        $('.buyNow').click(function () {
          $("#myModal").modal("show");
        })
        const form = document.querySelector("form");
        form.addEventListener("submit", (e) => {
          e.preventDefault();
          const formData = new FormData(form);
          const Token = sessionStorage.getItem("token");
          formData.append('email', sessionStorage.getItem("email"));
          axios
            .post("http://api.kerbengenam.my.id/v1/createStack?", formData, {
              headers: {
                "Content-Type": "multipart/form-data",
                "Authorization": `Bearer ${Token}`
              },
            })
            .then((res) => {
              alert(`selamat aplikasi anda berhasil diinstal. akses melalui ${res.data.app_domain}`)
            })
            .catch((err) => {
              alert("silahkan login terlebih dahulu");
              location.href = "http://kerbengenam.my.id/login.html";
            });
        });
      });
    </script>

    <div class="container">
      <div class="card mt-5 border-5 pt-2 active pb-0 px-3">
        <div class="card-body">
          <div class="row">
            <div class="col-12">
              <h4 class="card-title"><b id="email"></b></h4>
            </div>
            <hr />
            <div class="col-6">
              <table class="table">
                <thead>
                  <tr>
                    <th scope="col">No</th>
                    <th scope="col">Domain</th>
                    <th scope="col">Status</th>
                    <th scope="col">Redirect</th>
                  </tr>
                </thead>
                <tbody id="table">
                </tbody>
                </thead>
            </div>
            <div class="col-12" id="store">
              <div id="myModal" class="modal fade" tabindex="-1">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">Confirm Your Orders</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <form class="form-group px-5 py-3">
                      <div class="form-group">
                        <label for="exampleInputUsername1">Username</label>
                        <input type="username" class="form-control" id="exampleInputUsername1" aria-describedby="emailHelp"
                          placeholder="Enter Username" name="username">
                      </div>
                      <div class="form-group">
                        <label for="exampleInputApp1">App</label>
                        <input type="app" class="form-control" id="exampleInputApp1" placeholder="Enter App" name="app">
                      </div>
                      <div class="form-group">
                        <label for="exampleInputPassword1">Password</label>
                        <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Enter Password"
                          name="password">
                      </div>
                      <div class="form-group">
                        <label for="exampleInputSubdomain1">Subdomain</label>
                        <input type="subdomain" class="form-control" id="exampleInputSubdomain1"
                          placeholder="Enter Subdomain" name="subdomain">
                      </div>
                      <button type="submit" class="btn btn-primary">Checkout</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </head>
</html>
