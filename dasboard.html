<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>Kerja Bengkel 6</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- Favicons -->
    <link href="assets/img/logo.png" rel="logo" />
    <link href="assets/img/logo.png" rel="apple-touch-icon" />

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet" />

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/aos/aos.css" rel="stylesheet" />
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
    <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet" />
    <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.0/css/bootstrap.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/1.13.1/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.1/js/dataTables.bootstrap5.min.js"></script>

    <!-- Template Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet" />
    
    <script>
      const formData = new FormData();
      const Email = sessionStorage.getItem("email");
      const Token = sessionStorage.getItem("token");
      console.log(Token);
      formData.append("email", Email);
      axios
        .post("http://api.kerbengenam.my.id/v1/getUserDomain?", formData, {
          headers: {
            "Content-Type": "multipart/form-data",
            "Authorization": `Bearer ${Token}`
          },
        })
        .then((response) => {
          console.log(response);
          var Domain = response.data.domain;
          console.log(Domain)
          $(document).ready(function() {
            var parent = $('#email');
            $("#email").text(`Hi, ${Email}`);
            var table = $('#table-init').DataTable({
                columnDefs: [
                  {
                      targets: -1,
                      data: null,
                      defaultContent: '<button>Redirect!</button>',
                  },
                ],
            });
            for (let i = 0; i < Domain.length; i++) {
              const formData = new FormData();
              formData.append("domain", Domain[i]);
              axios.post("http://api.kerbengenam.my.id/v1/getWebsiteStatus?", formData, {
                headers: {
                  "Content-Type": "multipart/form-data",
                  "Authorization": `Bearer ${Token}`
                },
              })
              .then((response) => {
                table.row.add([
                  `${i}`,
                  `${Domain[i]}`,
                  `${response.data.status}`
              ]).draw();
                ///$("#table").prepend(`<tr><th scope="row${i}">${i}</th><td>${Domain[i]}</td><td>${response.data.status}</td><td><a class="btn btn-primary" href="http://${Domain[i]}" role="button">Redirect</a></td></tr>`);
              })
            $('#table-init tbody').on('click', 'button', function () {
              var data = table.row($(this).parents('tr')).data();
              window.location.assign(`http://${data[1]}`);
            });
          };
        })
      })
      .catch((error) => {
          console.error(error)
      });
    </script>

    <div class="container">
      <div class="card mt-5 border-5 pt-2 active pb-0 px-3">
        <div class="card-body">
          <div class="row">
            <div class="col-12">
              <h4 class="card-title"><b id="email"></b></h4>
            </div>
            <hr />
            <div class="col-12">
              <table class="table" id="table-init">
                <thead>
                  <tr>
                    <th scope="col">No</th>
                    <th scope="col">Domain</th>
                    <th scope="col">Status</th>
                    <th scope="col">Redirect</th>
                  </tr>
                </thead>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </head>
</html>
